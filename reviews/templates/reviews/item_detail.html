{% extends 'reviews/base.html' %}

{% block content %}
<div class="item-detail-container">
    <div class="item-detail-header">
        <div class="item-detail-image">
            {% if item.image %}
                <img src="{{ item.image.url }}" alt="{{ item.title }}">
            {% else %}
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f0f2f1; font-size: 4rem;"></div>
            {% endif %}
        </div>
        <div class="item-detail-info">
            <h1>{{ item.title }}</h1>
            <p><strong>Category:</strong> <span class="category-badge">{{ item.category.name }}</span></p>
            <p><strong>By:</strong> {{ item.author_or_director }}</p>
            <p>{{ item.description }}</p>
        </div>
    </div>

    <hr style="border: none; border-top: 2px solid #e5e7eb; margin: 40px 0;">

    <div class="reviews-section">
        <h3>Reviews</h3>
        {% if reviews %}
        <div>
            {% for review in reviews %}
            <div class="review-item">
                <strong>{{ review.author.username }}</strong>
                <span class="review-rating">⭐ {{ review.rating }}/10</span>
                <p>{{ review.text }}</p>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No reviews yet. Be the first to review!</p>
        {% endif %}
    </div>

    {% if user.is_authenticated %}
        {% if user_review_exists %}
        <div class="alert alert-info" style="margin-top: 32px;">
            <p>You have already submitted a review for this item.</p>
        </div>
        {% else %}
        <div class="add-review-section">
            <h3>Add Your Review</h3>
            <form method="POST">
                {% csrf_token %}

                <div style="display: none;">
                    {{ form.item }}
                </div>

                <div class="review-form-group">
                    <label for="id_text">Your Comment:</label>
                    {{ form.text }}
                </div>

                <div class="review-form-group">
                    <label for="id_rating">Rating (1-10):</label>
                    {{ form.rating }}
                </div>

                <button type="submit" class="btn btn-success">Post Review</button>
            </form>
        </div>
        {% endif %}
    {% else %}
    <div class="alert alert-info" style="margin-top: 32px;">
        <p><a href="{% url 'login' %}">Log in</a> to leave a review.</p>
    </div>
    {% endif %}

    <br>
    <a href="{% url 'item_list' %}" style="color: #10b981; text-decoration: none; font-weight: 700;">← Back to Catalog</a>
</div>
{% endblock %}