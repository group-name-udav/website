{% extends 'reviews/base.html' %}

{% block content %}
<div class="container">
    <h1>{{ item.title }}</h1>
    <p><strong>Category:</strong> {{ item.category.name }}</p>
    <p>{{ item.description }}</p>

    <hr>
    <h3>Reviews:</h3>
    <ul>
        {% for review in reviews %}
        <li>
            <strong>{{ review.author.username }}:</strong> {{ review.text }}
            (Rating: {{ review.rating }}/10)
        </li>
        {% empty %}
        <li>No reviews yet.</li>
        {% endfor %}
    </ul>

    <hr>
    {% if user.is_authenticated %}
    {% if user_review_exists %}
    <div style="padding: 15px; background-color: #e2e3e5; border-radius: 4px;">
        <p>You have already submitted a review for this item.</p>
    </div>
    {% else %}
    <h3>Add your Review</h3>
    <form method="POST">
        {% csrf_token %}

        <div style="display: none;">
            {{ form.item }}
        </div>

        <div style="margin-bottom: 10px;">
            <label for="id_text">Your Comment:</label><br>
            {{ form.text }}
        </div>

        <div style="margin-bottom: 10px;">
            <label for="id_rating">Rating (1-10):</label><br>
            {{ form.rating }}
        </div>

        <button type="submit" style="padding: 8px 16px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Post Review
        </button>
    </form>
    {% endif %}
    {% else %}
    <p><a href="{% url 'login' %}">Log in</a> to leave a review.</p>
    {% endif %}

    <br>
    <a href="{% url 'item_list' %}">Back to Catalog</a>
</div>
{% endblock %}